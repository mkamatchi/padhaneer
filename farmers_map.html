<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>PadhaNeer Connect – Palm Guardians</title>
  <link rel="icon" type="image/png" href="images/palm_tree.png">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Playfair+Display:wght@400;500;600;700&display=swap" rel="stylesheet">
  <!-- Leaflet + MarkerCluster CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster/dist/MarkerCluster.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster/dist/MarkerCluster.Default.css" />

  <style>
    :root{ --primary-green:#2D5A3D; --secondary-green:#4A7C59; --light-green:#E8F5E8; --warm-beige:#F7F3E9; --golden:#D4AF37; --text-dark:#2C3E50; --text-light:#6C7B7F; --shadow:rgba(0,0,0,0.1); }
    body{ margin:0; font-family:'Inter',sans-serif; background: linear-gradient(135deg, var(--warm-beige) 0%, var(--light-green) 100%); color: var(--text-dark); }
    .container{ max-width:1200px; margin: 0 auto; background:#fff; border-radius:20px; box-shadow:0 10px 30px var(--shadow); overflow:hidden }
    .hero{ background: linear-gradient(135deg, var(--primary-green), var(--secondary-green)); color:#fff; padding:2rem 1.5rem; text-align:center; position:relative }
    .hero h1{ font-family:'Playfair Display',serif; font-size: clamp(1.8rem,3.2vw,2.4rem); margin:0 0 .5rem }
    .hero p{ opacity:.95; margin:0; font-size:1.05rem }
    .controls{ background: var(--light-green); padding: 1rem; text-align:center; border-bottom:1px solid rgba(0,0,0,0.06); display:flex; flex-wrap:wrap; gap:.5rem; justify-content:center; align-items:center }
    .controls label{ font-weight:600; color: var(--text-dark) }
    .controls select{ margin:.25rem; padding:.6rem .8rem; font-size:14px; border-radius:10px; border:1px solid rgba(44,62,80,0.2); background:#fff; min-width: 180px }
    #map{ height: 70vh; }
    .leaflet-popup-content img{ width:100px; border-radius:8px; margin-top:5px }
    .legend{ background:#fff; padding:10px; border-radius:8px; box-shadow:0 2px 6px rgba(0,0,0,0.2); font-size:13px; line-height:1.5 }
    .legend-item{ display:flex; align-items:center; gap:6px }
    .color-box{ width:14px; height:14px; border-radius:3px }
    .controls .link-btn{ text-decoration:none; font-weight:600; color:#fff; background: linear-gradient(135deg, var(--primary-green), var(--secondary-green)); padding:.6rem .9rem; border-radius:999px; box-shadow:0 4px 12px rgba(45,90,61,.25) }
    @media(max-width:768px){ #map{ height: 60vh } .controls{ padding:.75rem } .controls select{ min-width: 46% } .hero{ padding:1.25rem 1rem } .hero h1{ font-size:1.6rem } .hero p{ font-size:.95rem } }
  </style>
  <!-- Critical navbar CSS to avoid flicker before JS loads -->
  <style id="critical-nav">
    .navbar{position:fixed;top:0;left:0;right:0;height:80px;background:#ffffff;border-bottom:1px solid rgba(0,0,0,0.06);z-index:1000}
    .nav-container{max-width:1200px;margin:0 auto;padding:1rem 2rem;display:flex;align-items:center;justify-content:space-between}
    .logo img{height:40px}
  </style>
  <script src="site-chrome.js" defer></script>
</head>

<body>
  <div id="site-header"></div>
  <div class="container">
    <section class="hero">
      <h1>Palm Guardians Map</h1>
      <p>Explore farmers and palm enthusiasts across India</p>
    </section>
    <div class="controls">
      <label>District:</label>
      <select id="districtFilter"><option value="all">All</option></select>
      <label>Occupation:</label>
      <select id="occupationFilter"><option value="all">All</option></select>
      <a href="farmers_list.html" class="link-btn" style="margin-left:12px;">🌾 View Directory</a>
    </div>
    <div id="map"></div>
  </div>

  <!-- Leaflet + MarkerCluster JS -->
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script src="https://unpkg.com/leaflet.markercluster/dist/leaflet.markercluster.js"></script>

  <script>
    const farmers = [
      {name:"Pandiyan", occupation:"Palm Climber/Tapper", district:"Villipuram", state:"TamilNadu", contact:"9500627289", lat:11.9394, lon:79.4924, img:"images/farmers/pandiyan.jpg"},
      {name:"Godson Samuel", occupation:"Palm Researcher, Writer", district:"Mumbai", state:"Maharashtra", contact:"9080250653", lat:19.0760, lon:72.8777, img:"images/farmers/default_farmer.jpg"},
      {name:"Ashok Kumar", occupation:"Farmer, Palm enthusiast", district:"Chennai", state:"TamilNadu", contact:"7760940880", lat:13.0827, lon:80.2707, img:"images/farmers/default_farmer.jpg"},
      {name:"Gunasekaran", occupation:"Palm Climber, Advocate", district:"Thanjavur", state:"TamilNadu", contact:"9600428150", lat:10.7870, lon:79.1378, img:"images/farmers/default_farmer.jpg"},
      {name:"Sankar", occupation:"Palm Climber/Tapper", district:"Kanniyakumar", state:"TamilNadu", contact:"9578065700", lat:8.0883, lon:77.5385, img:"images/farmers/default_farmer.jpg"},
      {name:"Dinesh", occupation:"Palm Climber/Tapper", district:"Pollachi", state:"TamilNadu", contact:"9750996456", lat:10.6587, lon:77.0104, img:"images/farmers/default_farmer.jpg"},
      {name:"Deepan", occupation:"Advocate", district:"Chennai", state:"TamilNadu", contact:"9791119203", lat:13.0827, lon:80.2707, img:"images/farmers/default_farmer.jpg"},
      {name:"Perumal Thiruthavadivel", occupation:"Palm Climber/Tapper", district:"Kanchipuram", state:"TamilNadu", contact:"9444138207", lat:12.8342, lon:79.7036, img:"images/farmers/default_farmer.jpg"},
      {name:"Arun Kumar", occupation:"Palm Climber/Tapper", district:"Ranipet", state:"TamilNadu", contact:"9788411602", lat:12.9493, lon:79.3181, img:"images/farmers/default_farmer.jpg"},
      {name:"Paramsivam", occupation:"Palm Climber/Tapper", district:"Chengalpattu", state:"TamilNadu", contact:"9566478030", lat:12.6920, lon:79.9771, img:"images/farmers/default_farmer.jpg"},
      {name:"Venkatachalam", occupation:"Palm Climber/Tapper", district:"Salem", state:"TamilNadu", contact:"9524446456", lat:11.6643, lon:78.1460, img:"images/farmers/default_farmer.jpg"},
      {name:"Tamilarasan", occupation:"Palm Climber/Tapper", district:"Dharmapuri", state:"TamilNadu", contact:"6382366867", lat:12.1211, lon:78.1582, img:"images/farmers/default_farmer.jpg"},
      {name:"Robin", occupation:"Palm Climber/Tapper", district:"Villipuram", state:"TamilNadu", contact:"6383274385", lat:11.9394, lon:79.4924, img:"images/farmers/default_farmer.jpg"},
      {name:"Nithyanandam", occupation:"Palm Climber/Tapper", district:"Villipuram", state:"TamilNadu", contact:"9943195043", lat:11.9394, lon:79.4924, img:"images/farmers/default_farmer.jpg"},
      {name:"Yesu Prakash", occupation:"Palm Climber/Tapper", district:"Villipuram", state:"TamilNadu", contact:"7667127284", lat:11.9394, lon:79.4924, img:"images/farmers/default_farmer.jpg"},
      {name:"Janakiraman", occupation:"Palm Climber/Tapper", district:"Villipuram", state:"TamilNadu", contact:"7667668325", lat:11.9394, lon:79.4924, img:"images/farmers/default_farmer.jpg"},
      {name:"Vadivelu Subramaniam", occupation:"Palm Activist", district:"Tirupattur", state:"TamilNadu", contact:"8270077060", lat:12.4966, lon:78.5656, img:"images/farmers/default_farmer.jpg"},
      {name:"Ananda Rajan", occupation:"Palm Climber/Tapper", district:"Tirunelveli", state:"TamilNadu", contact:"9789763688", lat:8.7139, lon:77.7567, img:"images/farmers/default_farmer.jpg"},
      {name:"Saravanan", occupation:"Palm Climber/Tapper", district:"Tiruvanamalai", state:"TamilNadu", contact:"7418124212", lat:12.2253, lon:79.0747, img:"images/farmers/default_farmer.jpg"},
      {name:"Arulanand", occupation:"Palm Activist", district:"Sivagangai", state:"TamilNadu", contact:"9786057501", lat:9.8473, lon:78.4805, img:"images/farmers/default_farmer.jpg"},
      {name:"Sudalaimani", occupation:"Palm Climber/Tapper", district:"Tirunelveli", state:"TamilNadu", contact:"9698485370", lat:8.7139, lon:77.7567, img:"images/farmers/default_farmer.jpg"},
      {name:"Ponnaiyan", occupation:"Palm Climber/Tapper", district:"Cuddalore", state:"TamilNadu", contact:"6381839223", lat:11.7480, lon:79.7714, img:"images/farmers/default_farmer.jpg"},
      {name:"Chanderasekaran", occupation:"Palm Farmer", district:"Namakkal", state:"TamilNadu", contact:"9842864512", lat:11.2189, lon:78.1652, img:"images/farmers/default_farmer.jpg"},
      {name:"Duraisamy", occupation:"Head of Palm Jaggery Production Cooperative Society", district:"Trichy", state:"TamilNadu", contact:"8526853888", lat:10.7905, lon:78.7047, img:"images/farmers/default_farmer.jpg"},
      {name:"Parthiban", occupation:"Palm Climber/Tapper", district:"Krishnagiri", state:"TamilNadu", contact:"9659916858", lat:12.5191, lon:78.2137, img:"images/farmers/default_farmer.jpg"},
      {name:"S.M.Murugan", occupation:"Palm Activist", district:"Tenkasi", state:"TamilNadu", contact:"9715914909", lat:8.9590, lon:77.3153, img:"images/farmers/default_farmer.jpg"},
      {name:"Antony", occupation:"Palm Climber/Tapper", district:"Thoothukudi", state:"TamilNadu", contact:"9080490560", lat:8.7642, lon:78.1348, img:"images/farmers/default_farmer.jpg"},
      {name:"Kesavan", occupation:"Palm Leaf Craftsman", district:"Tiruvallur", state:"TamilNadu", contact:"6380775372", lat:13.1436, lon:79.9080, img:"images/farmers/default_farmer.jpg"},
      {name:"Samuel Rajkumar", occupation:"Palm Climber/Tapper", district:"Villipuram", state:"TamilNadu", contact:"7708587235", lat:11.9394, lon:79.4924, img:"images/farmers/default_farmer.jpg"}
    ];

    const occupationColors = {
      "Palm Climber/Tapper":"green",
      "Palm Researcher, Writer":"blue",
      "Farmer, Palm enthusiast":"orange",
	  "Palm Farmer" : "orange",
      "Palm Activist":"red",
      "Palm Climber, Advocate":"red",
	  "Advocate":"red",
      "default":"gray"
    };

    const map = L.map("map").setView([11,78],7);
    L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
      attribution:"© OpenStreetMap contributors"
    }).addTo(map);

    // Populate dropdowns
    const districts = [...new Set(farmers.map(f=>f.district))];
    const occupations = [...new Set(farmers.map(f=>f.occupation))];
    const districtFilter=document.getElementById("districtFilter");
    const occupationFilter=document.getElementById("occupationFilter");

    districts.forEach(d=>{let o=document.createElement("option");o.value=d;o.textContent=d;districtFilter.appendChild(o);});
    occupations.forEach(o=>{let op=document.createElement("option");op.value=o;op.textContent=o;occupationFilter.appendChild(op);});

    let markerCluster = L.markerClusterGroup();

    function renderMarkers(){
      markerCluster.clearLayers();
      const districtVal=districtFilter.value;
      const occupationVal=occupationFilter.value;

      farmers.forEach(f=>{
        if((districtVal==="all"||f.district===districtVal)&&(occupationVal==="all"||f.occupation===occupationVal)){
          const color=occupationColors[f.occupation]||occupationColors.default;
          const marker=L.circleMarker([f.lat,f.lon],{
            color:color,
            radius:8,
            fillOpacity:0.8
          }).bindPopup(`
            <b>${f.name}</b><br>
            🌿 ${f.occupation}<br>
            📍 ${f.district}, ${f.state}<br>
            📞 ${f.contact}<br>
            <img src="${f.img}" alt="${f.name}">
          `);
          markerCluster.addLayer(marker);
        }
      });
      map.addLayer(markerCluster);
    }

    districtFilter.addEventListener("change",renderMarkers);
    occupationFilter.addEventListener("change",renderMarkers);
    renderMarkers();

    // ✅ Legend box (bottom-right)
    const legend = L.control({ position: "bottomright" });
    legend.onAdd = function () {
      const div = L.DomUtil.create("div", "legend");
      div.innerHTML = `
        <b>Legend</b><br>
        <div class="legend-item"><div class="color-box" style="background:green;"></div> Palm Climber/Tapper</div>
        <div class="legend-item"><div class="color-box" style="background:blue;"></div> Researcher / Writer</div>
        <div class="legend-item"><div class="color-box" style="background:orange;"></div> Farmer / Enthusiast</div>
        <div class="legend-item"><div class="color-box" style="background:red;"></div> Advocate / Activist</div>
      `;
      return div;
    };
    legend.addTo(map);
  </script>
  <div id="site-footer"></div>
  
</body>
</html>
